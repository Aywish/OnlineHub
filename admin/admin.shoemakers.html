<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title class="customer-name">Made in Marikina - Products</title>
    
        <!-- bootstrap and css -->
        <link type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="../css/AdminAccess.css">

        <!--javascript -->

        <script type="text/javascript">
            //popup
            function OpenPopup() {
                document.getElementById("popup_addSM").style.display = "block";
                document.getElementById("bgoverlay").style.display = "block";
            }

            // function OpenPopupView() {
            //     document.getElementById("popup_viewSM").style.display = "block";
            //     document.getElementById("bgoverlay").style.display = "block";
            // }

            function ClosePopup() {
                document.getElementById("popup_addSM").style.display = "none";
                document.getElementById("popup_viewSM").style.display = "none";
                document.getElementById("bgoverlay").style.display = "none";
            }
        </script>
    
        <!-- icons -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.0/font/bootstrap-icons.css">
    
    </head>
    <body>

        <div class="top-level">
            <div class="top-title">
                <h1>Manage Shoemakers.</h1>
            </div>
            <div class="top-buttons">
                <label for="add" class="buttonss products-add" onclick="OpenPopup()">
                    <i class="bi bi-plus-circle"></i>
                    <span>ADD</span>
                </label>
                <br>
            </div>
        </div>

        
        <!--POPUP-->
        <div class="popup" id="popup_addSM">
            <div class="popup-scrollable">
                <i class="bi bi-x" onclick="ClosePopup()"></i>
                <div class="popup-content">
                    <div class="profile-picture">
                        <img src="images/logo.png" alt="">
                    </div>
                    
                    <form action="" class="popup-form">
                        <h5>Store Information</h5>
                            <input type="text" placeholder="Full Store Name" class="storeName" id="storename">
                            <input type="text" placeholder="Registration Number" class="storeName" id="regnum" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');">
                        <h5>Full Name</h5>
                            <input type="text" placeholder="First Name" class="fullName" id="firstname">
                            <input type="text" placeholder="Middle Name" class="fullName" id="middlename">
                            <input type="text" placeholder="Last Name" class="fullName" id="lastname">
                            <input type="text" placeholder="Suffix" class="fullName" id="suffix">
                        <h5>Complete Address</h5>
                            <input type="text" placeholder="House No." class="address" id="houseno" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');">
                            <input type="text" placeholder="Street Name" class="address" id="streetname">
                            <input type="text" placeholder="Baranggay" class="address" id="barangay">
                            <input type="text" placeholder="City" class="address" id="city">
                            <input type="text" placeholder="Postal Code." class="address" id="postalcode" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');">
                        <h5>Contact Information</h5>
                            <input type="text" placeholder="Mobile Number" class="contact" id="mobilenumber" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');">
                            <input type="text" placeholder="Email Address" class="contact" id="email">
                    </form>
                </div>
            </div>
            <div class="addshoemaker">
                <a href="#" id="addshoemaker">ADD SHOEMAKER</a>
            </div>
        </div>

        <!--VIEW SHOEMAKER POPUP-->
        <div class="popup" id="popup_viewSM">
            <div class="popup-scrollable">
                <i class="bi bi-x" onclick="ClosePopup()"></i>
                <div class="popup-content">
                    <div class="profile-picture">
                        <img src="images/logo.png" alt="">
                    </div>

                    <form action="" class="popup-form">
                        <h5>Store Information</h5>
                            <p id="shoemaker_storename" class="shoemakers_view">Tatay Oly Shoes</p>
                            <p id="shoemaker_storeid" class="shoemakers_view">0123456789</p>
                        <h5>Full Name</h5>
                            <table class="shoemakers_view shoemakers_fullname">
                                <tr>
                                    <th>First Name:</th>
                                    <td id="viewFName">Rolando</td>
                                </tr>
                                <tr>
                                    <th>Middle Name:</th>
                                    <td id="viewMName"></td>
                                </tr>
                                <tr>
                                    <th>Last Name:</th>
                                    <td id="viewLName">Santos</td>
                                </tr>
                                <tr>
                                    <th>Suffix:</th>
                                    <td id="viewSuffix">Sr.</td>
                                </tr>
                            </table>
                        <h5>Complete Address</h5>
                            <table class="shoemakers_view shoemakers_fulladdress">
                                <tr>
                                    <th>House No:</th>
                                    <td id="viewHNo">365</td>
                                </tr>
                                <tr>
                                    <th>Street Name:</th>
                                    <td id="viewSN">J.P. Rizal</td>
                                </tr>
                                <tr>
                                    <th>Baranggay:</th>
                                    <td id="viewBrgy">Sto. Ni√±o</td>
                                </tr>
                                <tr>
                                    <th>City:</th>
                                    <td id="viewCity">Marikina</td>
                                </tr>
                                <tr>
                                    <th>Postal Code:</th>
                                    <td id="viewPC">1800</td>
                                </tr>
                            </table>
                        <h5>Contact Information</h5>
                        <table class="shoemakers_view shoemakers_fulladdress">
                            <tr>
                                <th>Mobile Number:</th>
                                <td id="viewCN">+639876543210</td>
                            </tr>
                            <tr>
                                <th>Email Address:</th>
                                <td id="viewEmail">tatayoly@gmail.com</td>
                            </tr>
                        </table>
                    </form>
                </div>
            </div>
            <!-- <div class="addshoemaker">
                <a href="#" id="addshoemaker">EDIT SHOEMAKER</a> -->
                <!--popup content will be like for add shoemaker and button will change to "SAVE CHANGES"... backend database data will also be updated-->
            <!-- </div> -->
        </div>
        <!--END OF POPUP-->

        <div class="table">
            <table id="admin-shmkrview">
                <tr>
                    <th><h4 class="admin-tblHeader">REG. NUMBER</h4></th>
                    <th><h4 class="admin-tblHeader">SHOP NAME</h4></th>
                    <th><h4 class="admin-tblHeader">SHOP OWNER</h4></th>
                    <th><h4 class="admin-tblHeader">ADDRESS</h4></th>
                    <th><h4 class="admin-tblHeader">ACTIONS</h4></th>
                </tr>
                
            </table>
        </div>

        <script>
            
            var userId = localStorage.getItem("userID");

            var storeName, regNum, firstName, middleName, lastName, suffix, houseNo, stName, brgy, city, postalCode, contactNo, email, viewshmkrId, shoemakerID;

            
            var shmkrReference = firebase.database().ref().child("users/").orderByChild('accountType').equalTo("shoemaker");

            shmkrReference.on("child_added", snap => {
                const shmkrId = snap.child("uid").val();
                var shopName = snap.child("storeName").val();
                var regNum = snap.child("registrationNum").val();
                var fName = snap.child("firstName").val();
                var lName = snap.child("lastName").val();
                var hNo = snap.child("houseNo").val();
                var brgy = snap.child("barangay").val();
                var city = snap.child("city").val();
                var pCode = snap.child("postalCode").val();
                var stName = snap.child("streetName").val();

                $("#admin-shmkrview").append('<tr><td>' + regNum + '</td><td><p>' + shopName + '</p></td><td><p>' + fName + ' ' + lName + '</p></td><td><p>' + hNo + ' ' + stName + ' '  + brgy + ', ' + city + ', ' + pCode + '</p></td><td><button class="button-actions" id="viewButton" value="' + shmkrId + '"><i class="bi bi-eye"></i><span>VIEW</span></button><button class="button-actions" id="deleteButton" value="' + shmkrId + '"><i class="fa fa-trash" aria-hidden="true"></i><span>DELETE</span></button></td></tr>');
            });

            function readAddForm() {
                storeName = document.getElementById("storename").value;
                regNum = document.getElementById("regnum").value;
                firstName = document.getElementById("firstname").value;
                middleName = document.getElementById("middlename").value;
                lastName = document.getElementById("lastname").value;
                suffix = document.getElementById("suffix").value;
                houseNo = document.getElementById("houseno").value;
                stName = document.getElementById("streetname").value;
                brgy = document.getElementById("barangay").value;
                city = document.getElementById("city").value;
                postalCode = document.getElementById("postalcode").value;
                contactNo = document.getElementById("mobilenumber").value;
                email = document.getElementById("email").value;
            };
    
            addshoemaker.onclick = function () {
                readAddForm();

                firebase.auth().createUserWithEmailAndPassword(email, "password" + storeName)
                    .then((userCredential) => {
                        // Signed up 
                        var user = userCredential.user;
                        console.log(user.uid);
                            firebase
                            .database()
                            .ref("users/" + user.uid)
                            .set({
                            uid: user.uid,
                            storeName: storeName,
                            registrationNum: regNum,
                            firstName: firstName,
                            middleName: middleName,
                            lastName: lastName,
                            suffix: suffix,
                            houseNo: houseNo,
                            streetName: stName,
                            barangay: brgy,
                            city: city,
                            postalCode: postalCode,
                            contactNo: contactNo,
                            email: email,
                            accountType: "shoemaker"
                        });
                alert("Shoemaker Added!");
                ClosePopup();
                });
            };

            //Get Value Attribute value 
            $(document).on('click', "#viewButton", function () {
                //alert($(this).val());
                shoemakerID = $(this).val();
                viewShoemakerPopup();
            });

            function viewShoemakerPopup(){
            
                console.log("Clicked! SMID is: " + String(shoemakerID));

                    firebase.database()
                        .ref("users/" + shoemakerID)
                        .on("value", function (snap) {
                            vwsname = snap.val().storeName;
                            vwregnum = snap.val().registrationNum;
                            vwfname = snap.val().firstName;
                            vwmname = snap.val().middleName;
                            vwlname = snap.val().lastName;
                            vwsuffix = snap.val().suffix;
                            vwhno = snap.val().houseNo;
                            vwstname = snap.val().streetName;
                            vwbrgy = snap.val().barangay;
                            vwcity = snap.val().city;
                            vwpcode = snap.val().postalCode;
                            vwcno = snap.val().contactNo;
                            vwemail = snap.val().email;
                        });
                    
                    document.getElementById("popup_viewSM").style.display = "block";
                    document.getElementById("bgoverlay").style.display = "block";

                    document.getElementById("shoemaker_storename").innerHTML = vwsname;
                    document.getElementById("shoemaker_storeid").innerHTML = vwregnum;
                    document.getElementById("viewFName").innerHTML = vwfname;
                    document.getElementById("viewMName").innerHTML = vwmname;
                    document.getElementById("viewLName").innerHTML = vwlname;
                    document.getElementById("viewSuffix").innerHTML = vwsuffix;
                    document.getElementById("viewHNo").innerHTML = vwhno;
                    document.getElementById("viewSN").innerHTML = vwstname;
                    document.getElementById("viewBrgy").innerHTML = vwbrgy;
                    document.getElementById("viewCity").innerHTML = vwcity;
                    document.getElementById("viewPC").innerHTML = vwpcode;
                    document.getElementById("viewCN").innerHTML = vwcno;
                    document.getElementById("viewEmail").innerHTML = vwemail;
            };
        </script>
        
    </body>
</html>